!function(){"use strict";var e,t={91520:function(e,t,r){r(64600),r(56844).c.start();var n=r(97320),a=r(20960),i=r(6640);const s="ADD_ARTICLES",o="PREPEND_ARTICLES",c="REMOVE_ARTICLE",l="SET_ARTICLES",d="UPDATE_ARTICLE",m="ADD_COMMENTS",u="REMOVE_COMMENT",p="SET_COMMENTS",f="UPDATE_COMMENT",y="PREPEND_USERS";function g(e){return{type:s,articles:e}}function h(e){return{type:l,articles:e}}function b(e,t){return{type:d,article:e,index:t}}function w(e,t){return{type:p,comments:e,articleId:t}}function v(e,t,r){return{type:f,comment:e,articleId:t,index:r}}var E=r(18928),_=r(524),I=(0,_.cp)(((e=[],t)=>{switch(t.type){case s:return e.concat(t.articles);case o:return t.articles.concat(e);case c:return e.filter((e=>e.id!==t.id));case l:return t.articles;case d:e[t.index]=t.article;break;default:return e}})),k=(0,_.cp)(((e={},t)=>{switch(t.type){case m:void 0===e[t.articleId]&&(e[t.articleId]=[]),e[t.articleId]=e[t.articleId].concat(t.comments);break;case u:if(null==e[t.articleId])return e;e[t.articleId]=e[t.articleId].filter((e=>e.id!==t.id));break;case p:e[t.articleId]=t.comments;break;case f:{const r=t.articleId;let n=t.index;if(!n){const a=e[r].find((e=>e.id===t.comment.id));n=e[r].indexOf(a)}e[r][n]=t.comment;break}default:return e}})),S=(0,_.cp)(((e=[],t)=>{switch(t.type){case"SET_USERS":return t.users;case y:return t.users.concat(e);default:return e}})),A=(0,E.TL)({articles:I,comments:k,users:S}),C=(0,E.eC)(A);const j=e=>function(t,r,n={}){let a=t[e];if(n.parentId&&(a=a[n.parentId]),void 0===a)return[null,null];const i=a.find((e=>e.id===r));return i?[i,a.indexOf(i)]:[null,null]},z=j("articles"),x=j("comments");function O(e,t,r){var n;return(t="symbol"==typeof(n=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t))?n:String(n))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class R extends n.Models.Base{constructor(e){super(e),this.published=null!=this.publishedAt}vulgarityLevel(){(null!=this.title&&/fuck/i.exec(this.title)||null!=this.content&&/fuck/i.exec(this.content))&&this.addErrorMessage("Article contains strong language.",{for:"base"})}setDefaultValuesForAdminReview(){this.adminRate=null==this.adminRate?3:this.adminRate,this.categoryId=null==this.categoryId?6:this.categoryId,this.adminReviewStartedAt=Date.now()}}O(R,"identity","Article"),O(R,"resources",{url:"/user/articles",paginate:{per:5},main:{url:"/articles",paginate:{per:3}},admin:{url:"/admin/articles",paginate:{per:4}}}),O(R,"attributes",{title:{validations:{presence:!0,length:{within:[3,255]}}},content:{validations:{presence:!0,length:{minimum:100}},remoteName:"text"},createdAt:{type:"Date",remoteName:"created_at"},updatedAt:{type:"Date",remoteName:"updated_at"},commentsCount:{type:"Int",remoteName:"comments_count"},publishedAt:{type:"Date",remoteName:"published_at"},published:{},adminReview:{remoteName:"admin_review"},adminRate:{type:"Int",remoteName:"admin_rate"},categoryId:{type:"Int",remoteName:"category_id"},adminReviewStartedAt:{remoteName:"admin_review_started_at"}}),O(R,"validate",["vulgarityLevel"]);var B=R;function T(e,t,r){var n;return(t="symbol"==typeof(n=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t))?n:String(n))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class $ extends n.Models.Base{constructor(e){super(e)}}T($,"identity","Article.Comment"),T($,"remoteName","Comment"),T($,"resources",{url:"/user/articles/:articleId/comments",paginate:{per:10},main:{url:"/articles/:articleId/comments",paginate:{per:5,param:"page-num"}},admin:{url:"/admin/articles/:articleId/comments",paginate:{per:5}}}),T($,"attributes",{author:{validations:{presence:!0}},text:{validations:{presence:!0,vulgarity:!0}},articleId:{type:"Int",validations:{presence:!0},remoteName:"article_id"},createdAt:{type:"Date",remoteName:"created_at"},updatedAt:{type:"Date",remoteName:"updated_at"},emotion:{type:"Int"},pinned:{type:"Boolean"},adminRate:{type:"Int",remoteName:"admin_rate"},approved:{type:"Boolean"}});var N=$;function M(e,t,r){var n;return(t="symbol"==typeof(n=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t))?n:String(n))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class D extends n.Models.Base{constructor(e){super(e)}}M(D,"identity","User"),M(D,"resources",{url:"/users",admin:{url:"/admin/users"}}),M(D,"paginate",{per:10}),M(D,"attributes",{email:{validations:{presence:!0,format:{with:/^([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})$/i}}},username:{validations:{presence:!0,format:{with:/^[a-z][a-z0-9_-]*$/i}}},password:{validations:{presence:{on:"create"},confirmation:!0}},passwordConfirmation:{remoteName:"password_confirmation"},confirmed:{},createdAt:{type:"Date",remoteName:"created_at"},updatedAt:{type:"Date",remoteName:"updated_at"}});var q=D,P=r(11504),L=r(97104),F=r(3268),U=r.n(F),H=class{constructor(e,t=(0,n.getLocale)()){this.date=e,this.skope=n.I18n[t].date}toString(e="default"){const t=this.skope.formats;switch(e){case"default":return this.strftime(t.default);case"short":return this.strftime(t.short);case"long":return this.strftime(t.long);default:console.log("Services.Date#toString: unknown format.")}}strftime(e){e=(e=e.replace("%Y",this.date.getFullYear())).replace("%y",this.date.getFullYear().toString().substr(-2,2));let t=this.date.getMonth()+1;return t=t>=10?t:`0${t}`,(e=(e=(e=(e=(e=(e=e.replace("%m",t)).replace("%b",this.skope.abbr_month_names[this.date.getMonth()])).replace("%B",this.skope.month_names[this.date.getMonth()])).replace("%d",this.date.getDate()>=10?this.date.getDate():`0${this.date.getDate()}`)).replace("%H",this.date.getHours()>=10?this.date.getHours():`0${this.date.getHours()}`)).replace("%M",this.date.getMinutes()>=10?this.date.getMinutes():`0${this.date.getMinutes()}`)).replace("%S",this.date.getSeconds()>=10?this.date.getSeconds():`0${this.date.getSeconds()}`)}};function V({comment:e}){const t=new H(e.createdAt).strftime("%d %b %y");return P.createElement("p",{id:`comment_${e.id}`},P.createElement("b",null,e.author)," on ",P.createElement("i",null,t)," (",P.createElement("a",{href:`/admin/articles/${e.articleId}/comments/${e.id}/edit`},"edit"),")",P.createElement("br",null),e.text)}V.propTypes={comment:U().instanceOf(N).isRequired};var W=V;function Y({comments:e}){return 0===e.length?P.createElement("p",null,"No comments"):P.createElement(P.Fragment,null,e.map((e=>P.createElement(W,{comment:e,key:e.id}))))}Y.propTypes={comments:U().arrayOf(U().instanceOf(N)).isRequired};var J=Y;const G=e=>{document.getElementById("article_author").textContent=e.author,document.getElementById("article_title").textContent=e.title,document.getElementById("article_text").textContent=e.content},K=e=>async function(t){if("updated"===t){const t=await e.reload();G(t)}};function Q({article:e}){const t=new H(e.publishedAt).toString("short");return P.createElement("article",{id:`article_${e.id}`},P.createElement("h2",null,e.title),P.createElement("p",null,P.createElement("i",null,e.author," wrote this on ",t," /"," ",P.createElement("span",{className:"comments_quantity"},e.commentsCount," comment",1===e.commentsCount?"":"s"))),P.createElement("p",null,e.content),P.createElement("p",null,P.createElement("a",{href:`/admin/articles/${e.id}/edit`},"Review")))}Q.propTypes={article:U().instanceOf(B).isRequired};var X=Q;function Z(e){const[t,r]=(0,P.useState)(e.articles);(0,P.useEffect)((()=>{const e=C.subscribe((()=>r(C.getState().articles)));return()=>{e()}}),[]);const n=t.map((e=>P.createElement(X,{key:e.id,article:e})));return P.createElement(P.Fragment,null,n)}Z.propTypes={articles:U().arrayOf(U().instanceOf(B)).isRequired};var ee=Z;const te=async()=>{const e=await B.find(n.helpers.params.id);(e=>{(0,n.subscribe)({to:e,with:K(e)}),G(e)})(e),(e=>{e.setDefaultValuesForAdminReview(),new a.UI.Form({id:"edit_article_form",for:e}).render()})(e)};const re=()=>window.location.href="/admin";const ne=({user:e})=>P.createElement("tr",{id:`user_${e.id}`},P.createElement("td",null,e.email),P.createElement("td",null,e.username),P.createElement("td",{className:"confirmed"},e.confirmed?"Yes":"No"),P.createElement("td",null,P.createElement("a",{href:`/admin/users/${e.id}`},"Show")," |"," ",P.createElement("a",{href:`/admin/users/${e.id}/edit`},"Edit")," |"," ",P.createElement("a",{href:`/admin/users/${e.id}`,"data-method":"delete","data-confirm":"Are you sure?"},"Delete")," ","|"," ",P.createElement("a",{href:"#",onClick:t=>((e,t)=>{e.preventDefault(),lt.emit({type:"PING",user_id:t})})(t,e.id)},"Ping")));ne.propTypes={user:U().instanceOf(q).isRequired};var ae=ne;function ie(e){const[t,r]=(0,P.useState)(e.users);(0,P.useEffect)((()=>{const e=C.subscribe((()=>r(C.getState().users)));return()=>{e()}}),[]);const n=t.map((e=>P.createElement(ae,{key:`user_${e.id}`,user:e})));return P.createElement(P.Fragment,null,n)}ie.propTypes={users:U().arrayOf(U().instanceOf(q)).isRequired};var se=ie;class oe extends n.Controllers.Base{initialize(){this.setScope("admin")}}oe.Articles=class{async published(){const e=await B.get("published");C.dispatch(h(e.resources)),(0,L.render)(P.createElement(ee,{articles:e.resources}),document.getElementById("articles"))}async edit(){te(),(async()=>{(e=>{(0,L.render)(P.createElement(J,{comments:e}),document.getElementById("comments"))})((await N.all({articleId:n.helpers.params.id})).resources)})()}},oe.Comments=class{edit(){((e={})=>{const t=new a.UI.Form({for:new N({id:e.commentId,resource:"admin"}),id:`edit_comment_${e.commentId}`,initObj:!0});t.render(),window.test={commentFormObj:t.getObj()}})({commentId:n.helpers.params.id})}},oe.Sessions=class{new(){new a.UI.Form({id:"sign_in_admin",callbackSuccess:re}).render()}},oe.Users=class{async index(){const e=await q.get("all");C.dispatch(function(e){return{type:y,users:e}}(e.resources)),(0,L.render)(P.createElement(se,{users:e.resources}),document.querySelector("table tbody"))}async show(){(e=>{document.getElementById("user_email").textContent=e.email,document.getElementById("user_username").textContent=e.username,document.getElementById("user_confirmed").textContent=e.confirmed?"Yes":"No",(e=>{const t=document.getElementById("edit_link"),r=t.getAttribute("href");t.setAttribute("href",r.replace("/0/",`/${e.id}/`))})(e)})(await q.find(n.helpers.params.id))}edit(){var e;e=new q({id:n.helpers.params.id}),new a.UI.Form({for:e,initObj:!0,id:"admin_user_form"}).render()}};var ce=oe;const le=(e,t)=>e.comments[t];function de({comment:e}){const t=new H(e.createdAt).strftime("%d %b %y");return P.createElement("p",{id:`comment_${e.id}`},P.createElement("b",null,e.author)," on ",P.createElement("i",null,t)," wrote:",P.createElement("br",null),e.text)}de.propTypes={comment:U().instanceOf(N).isRequired};var me=de;function ue(e){const t=e.articleId,[r,n]=(0,P.useState)(e.comments);(0,P.useEffect)((()=>{const e=C.subscribe((()=>{n(le(C.getState(),t))}));return()=>{e()}}),[]);const a=r.map((e=>P.createElement(me,{key:e.id,comment:e})));return 0===r.length?P.createElement("p",{id:"no_comments"},"No comments."):P.createElement(P.Fragment,null,a)}ue.propTypes={articleId:U().number.isRequired,comments:U().arrayOf(U().instanceOf(N)).isRequired};var pe=ue;function fe(e){const[t,r]=(0,P.useState)(e.comments);return(0,P.useEffect)((()=>{const t=C.subscribe((()=>{r(le(C.getState(),e.articleId))}));return()=>{t()}}),[]),P.createElement(P.Fragment,null,`${t.length} comment${1===t.length?"":"s"}`)}fe.propTypes={articleId:U().number.isRequired,comments:U().arrayOf(U().instanceOf(N)).isRequired};var ye=fe;const ge=(e,t,r)=>{null!=e[t]&&(r.classList.add(t),document.querySelector(".flash p").textContent=e[t])};var he=(e={})=>{const{hide:t}=e,r=document.querySelector(".flash");(e=>{e.classList.remove("notice"),e.classList.remove("alert"),e.classList.remove("warning")})(r),ge(e,"notice",r),ge(e,"alert",r),ge(e,"warning",r),r.classList.remove("none"),t&&((e=4e3)=>{setTimeout((()=>{document.querySelector(".flash").classList.add("none")}),e)})()};const be=e=>async function(t){switch(t){case"updating":he({warning:"Author is currently editing article. Be aware of possible changes."});break;case"updated":{const t=await e.reload();we(t,!0)}}},we=(e,t=!1)=>{!1===t&&(0,n.subscribe)({to:e,with:be(e)}),document.getElementById("title").textContent=e.title,document.getElementById("author").textContent=e.author;const r=new H(e.publishedAt);document.getElementById("pub_date").textContent=r.toString("short");const a=document.getElementById("text");a.innerHTML="";const i=((s=(s=(s=e.content).replace(/\r\n?/,"\n")).trim()).length>0&&(s="<p>"+(s=(s=s.replace(/\n\n+/g,"</p><p>")).replace(/\n/g,"<br>"))+"</p>"),s);var s;a.insertAdjacentHTML("beforeend",i)};var ve={renderArticle:we,renderForm:e=>{new a.UI.Form({for:e,initObj:!0,id:"new_comment"}).render()}};function Ee(){const[e,t]=(0,P.useState)(1),[r,n]=(0,P.useState)(!1);return r?P.createElement("span",null,"No more posts."):P.createElement("a",{href:"#",id:"load_more",onClick:async function(r){r.preventDefault();const a=e+1;t(a);let i=null;try{i=await B.get("all",{page:a})}catch(r){return void alert(`Invalid URL: ${r}`)}i.resources.length>0?C.dispatch(g(i.resources)):n(!0)}},"Load more…")}function _e({article:e}){const t=new H(e.publishedAt).toString("short");return P.createElement("article",{id:`article_${e.id}`},P.createElement("h2",null,e.title),P.createElement("p",null,P.createElement("i",null,e.author," wrote this on ",t," /"," ",P.createElement("a",{href:`/articles/${e.id}#comments`,className:"comments_quantity"},e.commentsCount," comment",1===e.commentsCount?"":"s"))),P.createElement("p",null,e.content),P.createElement("p",null,P.createElement("a",{href:`/articles/${e.id}`},"Continued…")))}_e.propTypes={article:U().instanceOf(B).isRequired};var Ie=_e;function ke(e){const[t,r]=(0,P.useState)(e.articles);(0,P.useEffect)((()=>{const e=C.subscribe((()=>r(C.getState().articles)));return()=>{e()}}),[]);const n=t.map((e=>P.createElement(Ie,{key:e.id,article:e})));return P.createElement(P.Fragment,null,n)}ke.propTypes={articles:U().arrayOf(U().instanceOf(B)).isRequired};var Se=ke;const Ae=e=>{switch(e){case"confirming":document.getElementById("verification_info").textContent=document.getElementById("verification_progress").textContent;break;case"confirmed":window.location.href="/user/sessions/new?event=confirmed"}},Ce=e=>{(0,n.subscribe)({to:new q({id:e.id}),with:Ae}),document.querySelector("form").style.display="none",document.getElementById("sign_in_paragraph").classList.remove("none"),document.getElementById("verification_info").classList.remove("none"),he({notice:e.notice})};class je extends n.Controllers.Base{initialize(){this.setScope("main")}}je.Articles=class{async show(){const e=new N({articleId:n.helpers.params.id});ve.renderForm(e),(async()=>{const e=await B.find(n.helpers.params.id);C.dispatch(h([e])),ve.renderArticle(e)})(),(async()=>{const e=await N.get("count",{articleId:n.helpers.params.id}),t=await N.all({articleId:n.helpers.params.id,total:e.total});C.dispatch(w(t,n.helpers.params.id)),(0,L.render)(P.createElement(pe,{articleId:n.helpers.params.id,comments:t}),document.getElementById("comments")),(0,L.render)(P.createElement(ye,{articleId:n.helpers.params.id,comments:t}),document.getElementById("comments_count"))})()}},je.Pages=class{async index(){(0,L.render)(P.createElement(Ee,null),document.getElementById("load_more_wrapper"));const e=await B.get("all",{page:1});C.dispatch(h(e.resources)),(0,L.render)(P.createElement(Se,{articles:e.resources}),document.getElementById("articles"))}},je.Users=class{new(){new a.UI.Form({for:new q,callbackSuccess:Ce}).render()}};var ze=je;function xe(e,t,r){var n;return(t="symbol"==typeof(n=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t))?n:String(n))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Oe extends n.Models.Base{constructor(e){super(e)}}xe(Oe,"identity","Room.Member"),xe(Oe,"resources",{url:"/user/rooms/:roomId/members",paginate:{per:100}});var Re,Be,Te,$e,Ne=Oe;class Me extends n.Models.Base{constructor(e){super(e)}}Re=Me,Te="Room",(Be="symbol"==typeof($e=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(Be="identity"))?$e:String($e))in Re?Object.defineProperty(Re,Be,{value:Te,enumerable:!0,configurable:!0,writable:!0}):Re[Be]=Te;var De=Me;const qe=e=>{document.querySelector(`#room_${e} td.members`)},Pe=(e,t)=>{switch(e){case"Room member_joined":(e=>{const t=qe(e);t.textContent=parseInt(t.text())+1})(t.room_id);break;case"Room member_left":(e=>{const t=qe(e);t.textContent=parseInt(t.text())-1})(t.room_id);break;case"Room created":document.getElementById("rooms_list").insertAdjacentHTML("beforeend",((r=t.room).id,r.name,r.id,void r.id));break;case"Room destroyed":{const e=document.getElementById(`room_${t.room_id}`);e.parentNode.removeChild(e)}}var r},Le=e=>{const t=`<li id='user_${e.id}'>${e.username}</li>`;document.getElementById("members").insertAdjacentHTML("beforeend",t)},Fe=e=>function(t,r){switch(t){case"Room member_joined":if(r.room_id!==e)return;Le(r.member);break;case"Room member_left":if(r.room_id!==e)return;(e=>{const t=document.querySelector(`#members li#user_${e.id}`);t.parentNode.removeChild(t)})(r.member)}};var Ue=(e,t)=>{const r=`<p class="msg"><b>${t}</b>: ${e}</p>`;document.getElementById("messages").insertAdjacentHTML("beforeend",r)},He=class{constructor(){this.callbacks={}}index(){(0,n.subscribe)({to:De,with:Pe})}async show(){var e;this.callbacks.receivedMessage=Ue,e=n.helpers.params.id,(0,n.subscribe)({to:De,with:Fe(e)}),(e=>{document.querySelector("[data-behavior~=room-speaker]").addEventListener("keypress",(t=>{13===t.keyCode&&(t.preventDefault(),lt.emit({type:"NEW_MESSAGE",txt:t.target.value,room_id:e}),t.target.value="")}))})(e);(e=>{for(const t of e)Le(t)})((await Ne.all({roomId:n.helpers.params.id})).resources)}};const Ve=e=>{document.getElementById("article_title").textContent=e.title,document.getElementById("article_text").textContent=e.content;const t=document.getElementById("publish_article");t&&null!=e.publishedAt?t.style.display="none":t&&(t.style.display="")},We=e=>async function(t){switch(t){case"updated":await e.reload(),e.applyChanges(),Ve(e);break;case"destroyed":window.location.href="/user/articles?message=deleted"}};function Ye({comment:e,isAdmin:t=!1}){const[r,n]=(0,P.useState)(!1),a=new H(e.createdAt).strftime("%d %b %y"),i=async t=>{t.preventDefault(),n(!0),e.approved=!0,(await e.updateAttribute("approved")).ok&&C.dispatch(v(new N({...e,approved:!0}),e.articleId))};return P.createElement("p",{id:`comment_${e.id}`},P.createElement("b",null,e.author)," on ",P.createElement("i",null,a),t?(()=>{let t;return t=e.approved?P.createElement(P.Fragment,null,P.createElement("span",null,"approved")," |"," "):r?P.createElement(P.Fragment,null,P.createElement("span",null,"approving...")," |"," "):P.createElement(P.Fragment,null,P.createElement("a",{href:`/user/articles/${e.articleId}/comments/${e.id}/approve`,className:"approve",onClick:i},"approve")," ","|"," "),P.createElement(P.Fragment,null," ","(",t,P.createElement("a",{href:`/user/articles/${e.articleId}/comments/${e.id}/edit`},"edit")," ","|"," ",P.createElement("a",{href:`/user/articles/${e.articleId}/comments/${e.id}`,"data-method":"delete","data-confirm":"Are you sure?"},"delete"),")")})():"",P.createElement("br",null),e.text)}Ye.propTypes={comment:U().instanceOf(N).isRequired,isAdmin:U().bool};var Je=Ye;function Ge(e){const t=e.articleId,r=e.isAdmin||!1,[n,a]=(0,P.useState)(e.comments);if((0,P.useEffect)((()=>{const e=C.subscribe((()=>a(le(C.getState(),t))));return()=>{e()}}),[]),0===n.length)return P.createElement("p",null,"No comments.");const i=n.map((e=>P.createElement(Je,{key:e.id,comment:e,isAdmin:r})));return P.createElement(P.Fragment,null,i)}Ge.propTypes={articleId:U().number.isRequired,isAdmin:U().bool,comments:U().arrayOf(U().instanceOf(N)).isRequired};var Ke=Ge;const Qe=e=>async function(t,r){switch(t){case"updating":document.querySelector("h1").getAttribute("data-mark")!==r.mark&&he({warning:"Uuups someone else started editing this article."});break;case"updated":await e.reload(),(e=>{for(const[t]of Object.entries(e.changes())){const r=document.querySelector(`a.apply_changes[data-for=${e.getAttrRemoteName(t)}]`);r&&r.classList.remove("none")}})(e);break;case"destroyed":window.location.href="/user/articles?message=deleted"}};var Xe=e=>{C.dispatch(g([e])),(0,n.subscribe)({to:e,with:Qe(e)});const t=new a.UI.Form({for:e});t.render(),(e=>{for(const t of Array.from(document.querySelectorAll("a.apply_changes")))t.addEventListener("click",(t=>{t.preventDefault();const r=e.getObj(),n=r.getAttrName(t.target.getAttribute("data-for"));r[n]=r.changes()[n].is,e.fill(n),t.target.classList.add("none")}))})(t)};function Ze({article:e,onArticleDestroyed:t}){return P.createElement("tr",{id:`article_${e.id}`},P.createElement("td",null,e.title),P.createElement("td",null,e.content),P.createElement("td",{className:"comments_quantity"},e.commentsCount),P.createElement("td",{className:"published"},e.publishedAt?"yes":"no"),P.createElement("td",null,P.createElement("a",{href:`/user/articles/${e.id}`},"Show")," |",P.createElement("a",{href:`/user/articles/${e.id}/edit`},"Edit")," |",P.createElement("a",{href:`/user/articles/${e.id}`,className:"delete_article",onClick:async r=>{if(r.preventDefault(),!confirm("Are you sure?"))return;const n=await e.delete(null);var a;n.success&&C.dispatch((a=n.id,{type:c,id:a})),t(n)}},"Delete")))}Ze.propTypes={article:U().instanceOf(B).isRequired,onArticleDestroyed:U().func.isRequired};var et=Ze;function tt(e){const[t,r]=(0,P.useState)(e.articles);(0,P.useEffect)((()=>{const e=C.subscribe((()=>r(C.getState().articles)));return()=>{e()}}),[]);const n=t.map((t=>P.createElement(et,{key:t.id,article:t,onArticleDestroyed:e.onArticleDestroyed})));return P.createElement(P.Fragment,null,n)}tt.propTypes={articles:U().arrayOf(U().instanceOf(B)).isRequired,onArticleDestroyed:U().func.isRequired};var rt=tt;const nt=e=>{e.success?he({notice:e.notice}):he({alert:e.alert})};class at extends n.Controllers.Base{}at.Articles=class{async index(){"deleted"===n.helpers.params.message&&he({alert:"Article has been deleted."});const e=await B.get("all");C.dispatch(h(e.resources)),(0,L.render)(P.createElement(rt,{articles:e.resources,onArticleDestroyed:nt}),document.getElementById("article_list"))}show(){(async()=>{const e=await B.find(n.helpers.params.id);C.dispatch(h([e])),(e=>{null!==e&&((0,n.subscribe)({to:e,with:We(e)}),(e=>{document.getElementById("publish_article").addEventListener("click",(async t=>{t.preventDefault(),t.target.textContent="Publishing...";try{await e.put("publish"),document.getElementById("publish_article").outerHTML="<span>Published!</span>"}catch(e){document.getElementById("publish_article").textContent="Publish",he({alert:"Connection error!"})}}))})(e),(e=>{const t=document.getElementById("edit_link").getAttribute("href");document.getElementById("edit_link").setAttribute("href",t.replace("/0/",`/${e}/`))})(e.id),Ve(e))})(e)})(),(async()=>{const e=await N.all({articleId:n.helpers.params.id});C.dispatch(w(e.resources,n.helpers.params.id)),(0,L.render)(P.createElement(Ke,{articleId:n.helpers.params.id,comments:e.resources}),document.getElementById("comments"))})()}new(){Xe(new B)}async edit(){(async e=>{const t=await N.all({articleId:e});C.dispatch(w(t.resources,e)),(0,L.render)(P.createElement(Ke,{articleId:e,comments:t.resources,isAdmin:!0}),document.getElementById("comments"))})(n.helpers.params.id);const e=await B.find(n.helpers.params.id);Xe(e)}},at.Rooms=He;var it=at;const st=({article_id:e},t)=>{const[r,n]=z(C.getState(),e);if(!r)return;const a=new B({...r,commentsCount:r.commentsCount+t});C.dispatch(b(a,n))};B.Comment=N,De.Member=Ne;const ot=(0,n.init)({cable:(0,i.gF)(),controllers:{Admin:ce,Main:ze,User:it},models:{Article:B,Room:De,User:q},notificationCenter:async e=>{switch(e.type){case"PING":lt.getEnv().namespaceController.constructor===it&&alert("Ping!");break;case"NEW_MESSAGE":(lt.getEnv().namespaceController.constructor!==it||lt.getEnv().controller.constructor!==He||"show"!==lt.getEnv().action?()=>{}:lt.getEnv().controller.callbacks.receivedMessage)(e.message,e.author);break;case"Article created":(async({id:e})=>{if(lt.getEnv().namespaceController.constructor!==it)return;const t=await B.find({id:e,abbr:!0});C.dispatch(g([t]))})(e.payload);break;case"Article published":(async({id:e})=>{if(lt.getEnv().namespaceController.constructor===ce){const t=await B.find({id:e,abbr:!0,resource:"admin"});C.dispatch(function(e){return{type:o,articles:e}}([t]))}else{const t=await B.find({id:e,abbr:!0});C.dispatch(g([t]))}})(e.payload);break;case"Article updated":(async({id:e})=>{const t={id:e,abbr:!0};lt.getEnv().namespaceController.constructor===ce&&(t.resource="admin");let[r,n]=z(C.getState(),e);r&&(r=await B.find(t),C.dispatch(b(r,n)))})(e.payload);break;case"Article.Comment created":(async({article_id:e,id:t})=>{const r={articleId:e,id:t};lt.getEnv().namespaceController.constructor===ze&&(r.resource="main");const[n]=z(C.getState(),e);if(!n)return;const a=await N.find(r);null!==a&&(C.dispatch(function(e,t){return{type:m,articleId:t,comments:e}}([a],e)),st({article_id:e},1))})(e.payload);break;case"Article.Comment destroyed":st(e.payload,-1),(({article_id:e,id:t})=>{C.dispatch(function(e,t){return{type:u,id:e,articleId:t}}(t,e))})(e.payload);break;case"Article.Comment updated":(async({article_id:e,id:t})=>{const[r,n]=x(C.getState(),t,{parentId:e});if(!r)return;const a=await r.reload();C.dispatch(v(a,e,n))})(e.payload);break;case"User created":{const t=await q.find(e.payload.id);C.dispatch(function(e){return{type:y,users:e}}([t]));break}}},notifications:{log:!0,size:10,disconnectedForTooLong:()=>{he({alert:"You have been disconnected from the server for too long. Reload page!",hide:!1})}},postInit:()=>{"test"===document.querySelector("body").getAttribute("data-rails-env")&&ot.getWire().setPollingTime(1e3)}});(0,a.connect)((0,n.createConnector)(ot));var ct,lt=ot;n.Validators.Vulgarity=(function(e,t,r){t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(ct=class extends n.Validators.Base{constructor(){super()}validate(){if(null!=this.val)switch(typeof this.val){case"string":{const e=this._getVulgarWord();if(!new RegExp(`${e}`,["i"]).exec(this.val))return;this._addErrorMessage();break}default:throw new TypeError(`Vulgarity validator is applicable only for strings and ${this.attr} isn't.`)}}_addErrorMessage(){const e=n.I18n[(0,n.getLocale)()].errors.messages.vulgarity;this.obj.addErrorMessage(e,{for:this.attr})}_getVulgarWord(){switch((0,n.getLocale)()){case"pl":return"kurwa";case"en":return"fuck"}}},"identity","Vulgarity"),ct),n.I18n.pl={variants:{few(e){const t=parseInt((r=String(e))[r.length-1]);var r;-1!==[2,3,4].indexOf(t)&&(2!==String(e).length||String(e)[0])}},models:{},attributes:{},ui:{form:{sending:"Wysyłam...",success:"Sukces",errors:{connection:"Błąd z połączeniem",invalid_data:"Nieprawidłowe dane"}}},date:{formats:{default:"%d-%m-%Y",short:"%d %b",long:"%B %d, %Y"},day_names:["niedziela","poniedziałek","wtorek","środa","czwartek","piątek","sobota"],abbr_day_names:["nie","pon","wto","śro","czw","pią","sob"],month_names:["styczeń","luty","marzec","kwiecień","maj","czerwiec","lipiec","sierpień","wrzesień","październik","listopad","grudzień"],abbr_month_names:["sty","lut","mar","kwi","maj","cze","lip","sie","wrz","paź","lis","gru"]},errors:{messages:{accepted:"musi zostać zaakceptowane",blank:"nie może być puste",confirmation:"nie zgadza się z polem %{attribute}",empty:"nie może być puste",equal_to:"musi być równe %{count}",even:"musi być parzyste",exclusion:"jest zarezerwowane",greater_than:"musi być większe od %{count}",greater_than_or_equal_to:"musi być większe lub równe %{count}",inclusion:"nie znajduje się na liście dopuszczalnych wartości",invalid:"jest nieprawidłowe",less_than:"musi być mniejsze od %{count}",less_than_or_equal_to:"musi być mniejsze lub równe %{count}",not_a_number:"nie jest liczbą",not_an_integer:"musi być liczbą całkowitą",odd:"musi być nieparzyste",present:"musi być puste",too_long:{few:"jest za długie (maksymalnie %{count} znaki)",many:"jest za długie (maksymalnie %{count} znaków)",one:"jest za długie (maksymalnie jeden znak)",other:"jest za długie (maksymalnie %{count} znaków)"},too_short:{few:"jest za krótkie (przynajmniej %{count} znaki)",many:"jest za krótkie (przynajmniej %{count} znaków)",one:"jest za krótkie (przynajmniej jeden znak)",other:"jest za krótkie (przynajmniej %{count} znaków)"},wrong_length:{few:"ma nieprawidłową długość (powinna wynosić %{count} znaki)",many:"ma nieprawidłową długość (powinna wynosić %{count} znaków)",one:"ma nieprawidłową długość (powinna wynosić jeden znak)",other:"ma nieprawidłową długość (powinna wynosić %{count} znaków)"},other_than:"musi być inna niż %{count}"}}},n.I18n.pl.models.User="Użytkownik",n.I18n.pl.attributes.User={password:"Hasło",passwordConfirmation:"Powtórz hasło"},n.I18n.en.errors.messages.vulgarity="contains strong language.",n.I18n.pl.errors.messages.vulgarity="zawiera mocny język.",n.I18n.en.date={formats:{default:"%Y-%m-%d",short:"%b %d",long:"%B %d, %Y"},day_names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr_day_names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_names:["January","February","March","April","May","June","July","August","September","October","November","December"],abbr_month_names:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},window.test={getLine:()=>lt.getLine(),getWire:()=>lt.getWire()}}},r={};function n(e){var a=r[e];if(void 0!==a)return a.exports;var i=r[e]={exports:{}};return t[e].call(i.exports,i,i.exports,n),i.exports}n.m=t,e=[],n.O=function(t,r,a,i){if(!r){var s=1/0;for(d=0;d<e.length;d++){r=e[d][0],a=e[d][1],i=e[d][2];for(var o=!0,c=0;c<r.length;c++)(!1&i||s>=i)&&Object.keys(n.O).every((function(e){return n.O[e](r[c])}))?r.splice(c--,1):(o=!1,i<s&&(s=i));if(o){e.splice(d--,1);var l=a();void 0!==l&&(t=l)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[r,a,i]},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={72:0};n.O.j=function(t){return 0===e[t]};var t=function(t,r){var a,i,s=r[0],o=r[1],c=r[2],l=0;if(s.some((function(t){return 0!==e[t]}))){for(a in o)n.o(o,a)&&(n.m[a]=o[a]);if(c)var d=c(n)}for(t&&t(r);l<s.length;l++)i=s[l],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(d)},r=self.webpackChunk=self.webpackChunk||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var a=n.O(void 0,[968],(function(){return n(91520)}));a=n.O(a)}();
//# sourceMappingURL=application.js.map