!function(){"use strict";var e,t={43312:function(e,t,n){n(28594);var r=n(18535);n.n(r)().start();var a=n(4940),i=n(30130),s=n(26936);const o="ADD_ARTICLES",c="PREPEND_ARTICLES",l="REMOVE_ARTICLE",d="SET_ARTICLES",u="UPDATE_ARTICLE",m="ADD_COMMENTS",p="REMOVE_COMMENT",f="SET_COMMENTS",y="UPDATE_COMMENT",g="PREPEND_USERS",h="SET_USERS";function b(e){return{type:o,articles:e}}function v(e){return{type:d,articles:e}}function w(e,t){return{type:u,article:e,index:t}}function E(e,t){return{type:f,comments:e,articleId:t}}function _(e,t,n){return{type:y,comment:e,articleId:t,index:n}}var I=n(14890),k=n(12902),S=(0,k.ZP)((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case o:return e.concat(t.articles);case c:return t.articles.concat(e);case l:return e.filter((e=>e.id!==t.id));case d:return t.articles;case u:e[t.index]=t.article;break;default:return e}})),A=(0,k.ZP)((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case m:void 0===e[t.articleId]&&(e[t.articleId]=[]),e[t.articleId]=e[t.articleId].concat(t.comments);break;case p:if(null==e[t.articleId])return e;e[t.articleId]=e[t.articleId].filter((e=>e.id!==t.id));break;case f:e[t.articleId]=t.comments;break;case y:{const n=t.articleId;let r=t.index;if(!r){const a=e[n].find((e=>e.id===t.comment.id));r=e[n].indexOf(a)}e[n][r]=t.comment;break}default:return e}})),j=(0,k.ZP)((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case h:return t.users;case g:return t.users.concat(e);default:return e}})),z=(0,I.UY)({articles:S,comments:A,users:j}),C=(0,I.MT)(z);const x=e=>function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=t[e];if(r.parentId&&(a=a[r.parentId]),void 0===a)return[null,null];const i=a.find((e=>e.id===n));if(!i)return[null,null];const s=a.indexOf(i);return[i,s]},O=x("articles"),R=x("comments");function B(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class T extends a.Models.Base{constructor(e){super(e),this.published=null!=this.publishedAt}vulgarityLevel(){(null!=this.title&&/fuck/i.exec(this.title)||null!=this.content&&/fuck/i.exec(this.content))&&this.addErrorMessage("Article contains strong language.",{for:"base"})}setDefaultValuesForAdminReview(){this.adminRate=null==this.adminRate?3:this.adminRate,this.categoryId=null==this.categoryId?6:this.categoryId,this.adminReviewStartedAt=Date.now()}}B(T,"identity","Article"),B(T,"resources",{url:"/user/articles",paginate:{per:5},main:{url:"/articles",paginate:{per:3}},admin:{url:"/admin/articles",paginate:{per:4}}}),B(T,"attributes",{title:{validations:{presence:!0,length:{within:[3,255]}}},content:{validations:{presence:!0,length:{minimum:100}},remoteName:"text"},createdAt:{type:"Date",remoteName:"created_at"},updatedAt:{type:"Date",remoteName:"updated_at"},commentsCount:{type:"Int",remoteName:"comments_count"},publishedAt:{type:"Date",remoteName:"published_at"},published:{},adminReview:{remoteName:"admin_review"},adminRate:{type:"Int",remoteName:"admin_rate"},categoryId:{type:"Int",remoteName:"category_id"},adminReviewStartedAt:{remoteName:"admin_review_started_at"}}),B(T,"validate",["vulgarityLevel"]);var $=T;function M(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class N extends a.Models.Base{constructor(e){super(e)}}M(N,"identity","Article.Comment"),M(N,"remoteName","Comment"),M(N,"resources",{url:"/user/articles/:articleId/comments",paginate:{per:10},main:{url:"/articles/:articleId/comments",paginate:{per:5,param:"page-num"}},admin:{url:"/admin/articles/:articleId/comments",paginate:{per:5}}}),M(N,"attributes",{author:{validations:{presence:!0}},text:{validations:{presence:!0,vulgarity:!0}},articleId:{type:"Int",validations:{presence:!0},remoteName:"article_id"},createdAt:{type:"Date",remoteName:"created_at"},updatedAt:{type:"Date",remoteName:"updated_at"},emotion:{type:"Int"},pinned:{type:"Boolean"},adminRate:{type:"Int",remoteName:"admin_rate"},approved:{type:"Boolean"}});var D=N;function P(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class q extends a.Models.Base{constructor(e){super(e)}}P(q,"identity","User"),P(q,"resources",{url:"/users",admin:{url:"/admin/users"}}),P(q,"paginate",{per:10}),P(q,"attributes",{email:{validations:{presence:!0,format:{with:/^([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})$/i}}},username:{validations:{presence:!0,format:{with:/^[a-z][a-z0-9_-]*$/i}}},password:{validations:{presence:{on:"create"},confirmation:!0}},passwordConfirmation:{remoteName:"password_confirmation"},confirmed:{},createdAt:{type:"Date",remoteName:"created_at"},updatedAt:{type:"Date",remoteName:"updated_at"}});var L=q,F=n(67294),U=n(73935),H=n(45697),V=n.n(H),Y=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,a.getLocale)();this.date=e,this.skope=a.I18n[t].date}toString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";const t=this.skope.formats;switch(e){case"default":return this.strftime(t.default);case"short":return this.strftime(t.short);case"long":return this.strftime(t.long);default:console.log("Services.Date#toString: unknown format.")}}strftime(e){e=(e=e.replace("%Y",this.date.getFullYear())).replace("%y",this.date.getFullYear().toString().substr(-2,2));let t=this.date.getMonth()+1;return t=t>=10?t:`0${t}`,(e=(e=(e=(e=(e=(e=e.replace("%m",t)).replace("%b",this.skope.abbr_month_names[this.date.getMonth()])).replace("%B",this.skope.month_names[this.date.getMonth()])).replace("%d",this.date.getDate()>=10?this.date.getDate():`0${this.date.getDate()}`)).replace("%H",this.date.getHours()>=10?this.date.getHours():`0${this.date.getHours()}`)).replace("%M",this.date.getMinutes()>=10?this.date.getMinutes():`0${this.date.getMinutes()}`)).replace("%S",this.date.getSeconds()>=10?this.date.getSeconds():`0${this.date.getSeconds()}`)}};function W(e){let{comment:t}=e;const n=new Y(t.createdAt).strftime("%d %b %y");return F.createElement("p",{id:`comment_${t.id}`},F.createElement("b",null,t.author)," on ",F.createElement("i",null,n)," (",F.createElement("a",{href:`/admin/articles/${t.articleId}/comments/${t.id}/edit`},"edit"),")",F.createElement("br",null),t.text)}W.propTypes={comment:V().instanceOf(D).isRequired};var J=W;function G(e){let{comments:t}=e;return 0===t.length?F.createElement("p",null,"No comments"):F.createElement(F.Fragment,null,t.map((e=>F.createElement(J,{comment:e,key:e.id}))))}G.propTypes={comments:V().arrayOf(V().instanceOf(D)).isRequired};var Z=G;const K=e=>{document.getElementById("article_author").textContent=e.author,document.getElementById("article_title").textContent=e.title,document.getElementById("article_text").textContent=e.content},Q=e=>async function(t){if("updated"===t){const t=await e.reload();K(t)}};function X(e){let{article:t}=e;const n=new Y(t.publishedAt).toString("short");return F.createElement("article",{id:`article_${t.id}`},F.createElement("h2",null,t.title),F.createElement("p",null,F.createElement("i",null,t.author," wrote this on ",n," /"," ",F.createElement("span",{className:"comments_quantity"},t.commentsCount," comment",1===t.commentsCount?"":"s"))),F.createElement("p",null,t.content),F.createElement("p",null,F.createElement("a",{href:`/admin/articles/${t.id}/edit`},"Review")))}X.propTypes={article:V().instanceOf($).isRequired};var ee=X;function te(e){const[t,n]=(0,F.useState)(e.articles);(0,F.useEffect)((()=>{const e=C.subscribe((()=>n(C.getState().articles)));return()=>{e()}}),[]);const r=t.map((e=>F.createElement(ee,{key:e.id,article:e})));return F.createElement(F.Fragment,null,r)}te.propTypes={articles:V().arrayOf(V().instanceOf($)).isRequired};var ne=te;const re=async()=>{const e=await $.find(a.helpers.params.id);(e=>{(0,a.subscribe)({to:e,with:Q(e)}),K(e)})(e),(e=>{e.setDefaultValuesForAdminReview(),new i.UI.Form({id:"edit_article_form",for:e}).render()})(e)};const ae=()=>window.location.href="/admin";const ie=e=>{let{user:t}=e;return F.createElement("tr",{id:`user_${t.id}`},F.createElement("td",null,t.email),F.createElement("td",null,t.username),F.createElement("td",{className:"confirmed"},t.confirmed?"Yes":"No"),F.createElement("td",null,F.createElement("a",{href:`/admin/users/${t.id}`},"Show")," |"," ",F.createElement("a",{href:`/admin/users/${t.id}/edit`},"Edit")," |"," ",F.createElement("a",{href:`/admin/users/${t.id}`,"data-method":"delete","data-confirm":"Are you sure?"},"Delete")," ","|"," ",F.createElement("a",{href:"#",onClick:e=>((e,t)=>{e.preventDefault(),pt.emit({type:"PING",user_id:t})})(e,t.id)},"Ping")))};ie.propTypes={user:V().instanceOf(L).isRequired};var se=ie;function oe(e){const[t,n]=(0,F.useState)(e.users);(0,F.useEffect)((()=>{const e=C.subscribe((()=>n(C.getState().users)));return()=>{e()}}),[]);const r=t.map((e=>F.createElement(se,{key:`user_${e.id}`,user:e})));return F.createElement(F.Fragment,null,r)}oe.propTypes={users:V().arrayOf(V().instanceOf(L)).isRequired};var ce=oe;class le extends a.Controllers.Base{initialize(){this.setScope("admin")}}le.Articles=class{async published(){const e=await $.get("published");C.dispatch(v(e.resources)),(0,U.render)(F.createElement(ne,{articles:e.resources}),document.getElementById("articles"))}async edit(){re(),(async()=>{(e=>{(0,U.render)(F.createElement(Z,{comments:e}),document.getElementById("comments"))})((await D.all({articleId:a.helpers.params.id})).resources)})()}},le.Comments=class{edit(){!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=new i.UI.Form({for:new D({id:e.commentId,resource:"admin"}),id:`edit_comment_${e.commentId}`,initObj:!0});t.render(),window.test={commentFormObj:t.getObj()}}({commentId:a.helpers.params.id})}},le.Sessions=class{new(){new i.UI.Form({id:"sign_in_admin",callbackSuccess:ae}).render()}},le.Users=class{async index(){const e=await L.get("all");C.dispatch(function(e){return{type:g,users:e}}(e.resources)),(0,U.render)(F.createElement(ce,{users:e.resources}),document.querySelector("table tbody"))}async show(){(e=>{document.getElementById("user_email").textContent=e.email,document.getElementById("user_username").textContent=e.username,document.getElementById("user_confirmed").textContent=e.confirmed?"Yes":"No",(e=>{const t=document.getElementById("edit_link"),n=t.getAttribute("href");t.setAttribute("href",n.replace("/0/",`/${e.id}/`))})(e)})(await L.find(a.helpers.params.id))}edit(){var e;e=new L({id:a.helpers.params.id}),new i.UI.Form({for:e,initObj:!0,id:"admin_user_form"}).render()}};var de=le;const ue=(e,t)=>e.comments[t];function me(e){let{comment:t}=e;const n=new Y(t.createdAt).strftime("%d %b %y");return F.createElement("p",{id:`comment_${t.id}`},F.createElement("b",null,t.author)," on ",F.createElement("i",null,n)," wrote:",F.createElement("br",null),t.text)}me.propTypes={comment:V().instanceOf(D).isRequired};var pe=me;function fe(e){const t=e.articleId,[n,r]=(0,F.useState)(e.comments);(0,F.useEffect)((()=>{const e=C.subscribe((()=>{r(ue(C.getState(),t))}));return()=>{e()}}),[]);const a=n.map((e=>F.createElement(pe,{key:e.id,comment:e})));return 0===n.length?F.createElement("p",{id:"no_comments"},"No comments."):F.createElement(F.Fragment,null,a)}fe.propTypes={articleId:V().number.isRequired,comments:V().arrayOf(V().instanceOf(D)).isRequired};var ye=fe;function ge(e){const[t,n]=(0,F.useState)(e.comments);return(0,F.useEffect)((()=>{const t=C.subscribe((()=>{n(ue(C.getState(),e.articleId))}));return()=>{t()}}),[]),F.createElement(F.Fragment,null,`${t.length} comment${1===t.length?"":"s"}`)}ge.propTypes={articleId:V().number.isRequired,comments:V().arrayOf(V().instanceOf(D)).isRequired};var he=ge;const be=e=>((e=(e=e.replace(/\r\n?/,"\n")).trim()).length>0&&(e="<p>"+(e=(e=e.replace(/\n\n+/g,"</p><p>")).replace(/\n/g,"<br>"))+"</p>"),e),ve=e=>{e.classList.remove("notice"),e.classList.remove("alert"),e.classList.remove("warning")},we=(e,t,n)=>{null!=e[t]&&(n.classList.add(t),document.querySelector(".flash p").textContent=e[t])},Ee=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4e3;setTimeout((()=>{document.querySelector(".flash").classList.add("none")}),e)};var _e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{hide:t}=e,n=document.querySelector(".flash");ve(n),we(e,"notice",n),we(e,"alert",n),we(e,"warning",n),n.classList.remove("none"),t&&Ee()};const Ie=e=>async function(t){switch(t){case"updating":_e({warning:"Author is currently editing article. Be aware of possible changes."});break;case"updated":{const t=await e.reload();ke(t,!0)}}},ke=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!1===t&&(0,a.subscribe)({to:e,with:Ie(e)}),document.getElementById("title").textContent=e.title,document.getElementById("author").textContent=e.author;const n=new Y(e.publishedAt);document.getElementById("pub_date").textContent=n.toString("short");const r=document.getElementById("text");r.innerHTML="";const i=be(e.content);r.insertAdjacentHTML("beforeend",i)};var Se={renderArticle:ke,renderForm:e=>{new i.UI.Form({for:e,initObj:!0,id:"new_comment"}).render()}};function Ae(){const[e,t]=(0,F.useState)(1),[n,r]=(0,F.useState)(!1);return n?F.createElement("span",null,"No more posts."):F.createElement("a",{href:"#",id:"load_more",onClick:async function(n){n.preventDefault();const a=e+1;t(a);let i=null;try{i=await $.get("all",{page:a})}catch(n){return void alert(`Invalid URL: ${n}`)}i.resources.length>0?C.dispatch(b(i.resources)):r(!0)}},"Load more…")}function je(e){let{article:t}=e;const n=new Y(t.publishedAt).toString("short");return F.createElement("article",{id:`article_${t.id}`},F.createElement("h2",null,t.title),F.createElement("p",null,F.createElement("i",null,t.author," wrote this on ",n," /"," ",F.createElement("a",{href:`/articles/${t.id}#comments`,className:"comments_quantity"},t.commentsCount," comment",1===t.commentsCount?"":"s"))),F.createElement("p",null,t.content),F.createElement("p",null,F.createElement("a",{href:`/articles/${t.id}`},"Continued…")))}je.propTypes={article:V().instanceOf($).isRequired};var ze=je;function Ce(e){const[t,n]=(0,F.useState)(e.articles);(0,F.useEffect)((()=>{const e=C.subscribe((()=>n(C.getState().articles)));return()=>{e()}}),[]);const r=t.map((e=>F.createElement(ze,{key:e.id,article:e})));return F.createElement(F.Fragment,null,r)}Ce.propTypes={articles:V().arrayOf(V().instanceOf($)).isRequired};var xe=Ce;const Oe=e=>{switch(e){case"confirming":document.getElementById("verification_info").textContent=document.getElementById("verification_progress").textContent;break;case"confirmed":window.location.href="/user/sessions/new?event=confirmed"}},Re=e=>{(0,a.subscribe)({to:new L({id:e.id}),with:Oe}),document.querySelector("form").style.display="none",document.getElementById("sign_in_paragraph").classList.remove("none"),document.getElementById("verification_info").classList.remove("none"),_e({notice:e.notice})};class Be extends a.Controllers.Base{initialize(){this.setScope("main")}}Be.Articles=class{async show(){const e=new D({articleId:a.helpers.params.id});Se.renderForm(e),(async()=>{const e=await $.find(a.helpers.params.id);C.dispatch(v([e])),Se.renderArticle(e)})(),(async()=>{const e=await D.get("count",{articleId:a.helpers.params.id}),t=await D.all({articleId:a.helpers.params.id,total:e.total});C.dispatch(E(t,a.helpers.params.id)),(0,U.render)(F.createElement(ye,{articleId:a.helpers.params.id,comments:t}),document.getElementById("comments")),(0,U.render)(F.createElement(he,{articleId:a.helpers.params.id,comments:t}),document.getElementById("comments_count"))})()}},Be.Pages=class{async index(){(0,U.render)(F.createElement(Ae,null),document.getElementById("load_more_wrapper"));const e=await $.get("all",{page:1});C.dispatch(v(e.resources)),(0,U.render)(F.createElement(xe,{articles:e.resources}),document.getElementById("articles"))}},Be.Users=class{new(){new i.UI.Form({for:new L,callbackSuccess:Re}).render()}};var Te=Be;function $e(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Me extends a.Models.Base{constructor(e){super(e)}}$e(Me,"identity","Room.Member"),$e(Me,"resources",{url:"/user/rooms/:roomId/members",paginate:{per:100}});var Ne,De,Pe,qe=Me;class Le extends a.Models.Base{constructor(e){super(e)}}Ne=Le,Pe="Room",(De=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(De="identity"))in Ne?Object.defineProperty(Ne,De,{value:Pe,enumerable:!0,configurable:!0,writable:!0}):Ne[De]=Pe;var Fe=Le;const Ue=e=>{document.querySelector(`#room_${e} td.members`)},He=(e,t)=>{switch(e){case"Room member_joined":(e=>{const t=Ue(e);t.textContent=parseInt(t.text())+1})(t.room_id);break;case"Room member_left":(e=>{const t=Ue(e);t.textContent=parseInt(t.text())-1})(t.room_id);break;case"Room created":document.getElementById("rooms_list").insertAdjacentHTML("beforeend",((n=t.room).id,n.name,n.id,void n.id));break;case"Room destroyed":{const e=document.getElementById(`room_${t.room_id}`);e.parentNode.removeChild(e)}}var n},Ve=e=>{const t=`<li id='user_${e.id}'>${e.username}</li>`;document.getElementById("members").insertAdjacentHTML("beforeend",t)},Ye=e=>function(t,n){switch(t){case"Room member_joined":if(n.room_id!==e)return;Ve(n.member);break;case"Room member_left":if(n.room_id!==e)return;(e=>{const t=document.querySelector(`#members li#user_${e.id}`);t.parentNode.removeChild(t)})(n.member)}};var We=(e,t)=>{const n=`<p class="msg"><b>${t}</b>: ${e}</p>`;document.getElementById("messages").insertAdjacentHTML("beforeend",n)},Je=class{constructor(){this.callbacks={}}index(){(0,a.subscribe)({to:Fe,with:He})}async show(){var e;this.callbacks.receivedMessage=We,e=a.helpers.params.id,(0,a.subscribe)({to:Fe,with:Ye(e)}),(e=>{document.querySelector("[data-behavior~=room-speaker]").addEventListener("keypress",(t=>{13===t.keyCode&&(t.preventDefault(),pt.emit({type:"NEW_MESSAGE",txt:t.target.value,room_id:e}),t.target.value="")}))})(e);(e=>{for(const t of e)Ve(t)})((await qe.all({roomId:a.helpers.params.id})).resources)}};const Ge=e=>{document.getElementById("article_title").textContent=e.title,document.getElementById("article_text").textContent=e.content;const t=document.getElementById("publish_article");t&&null!=e.publishedAt?t.style.display="none":t&&(t.style.display="")},Ze=e=>async function(t){switch(t){case"updated":await e.reload(),e.applyChanges(),Ge(e);break;case"destroyed":window.location.href="/user/articles?message=deleted"}};function Ke(e){let{comment:t,isAdmin:n=!1}=e;const[r,a]=(0,F.useState)(!1),i=new Y(t.createdAt).strftime("%d %b %y"),s=async e=>{e.preventDefault(),a(!0),t.approved=!0,(await t.updateAttribute("approved")).ok&&C.dispatch(_(new D({...t,approved:!0}),t.articleId))};return F.createElement("p",{id:`comment_${t.id}`},F.createElement("b",null,t.author)," on ",F.createElement("i",null,i),n?(()=>{let e;return e=t.approved?F.createElement(F.Fragment,null,F.createElement("span",null,"approved")," |"," "):r?F.createElement(F.Fragment,null,F.createElement("span",null,"approving...")," |"," "):F.createElement(F.Fragment,null,F.createElement("a",{href:`/user/articles/${t.articleId}/comments/${t.id}/approve`,className:"approve",onClick:s},"approve")," ","|"," "),F.createElement(F.Fragment,null," ","(",e,F.createElement("a",{href:`/user/articles/${t.articleId}/comments/${t.id}/edit`},"edit")," ","|"," ",F.createElement("a",{href:`/user/articles/${t.articleId}/comments/${t.id}`,"data-method":"delete","data-confirm":"Are you sure?"},"delete"),")")})():"",F.createElement("br",null),t.text)}Ke.propTypes={comment:V().instanceOf(D).isRequired,isAdmin:V().bool};var Qe=Ke;function Xe(e){const t=e.articleId,n=e.isAdmin||!1,[r,a]=(0,F.useState)(e.comments);if((0,F.useEffect)((()=>{const e=C.subscribe((()=>a(ue(C.getState(),t))));return()=>{e()}}),[]),0===r.length)return F.createElement("p",null,"No comments.");const i=r.map((e=>F.createElement(Qe,{key:e.id,comment:e,isAdmin:n})));return F.createElement(F.Fragment,null,i)}Xe.propTypes={articleId:V().number.isRequired,isAdmin:V().bool,comments:V().arrayOf(V().instanceOf(D)).isRequired};var et=Xe;const tt=e=>async function(t,n){switch(t){case"updating":document.querySelector("h1").getAttribute("data-mark")!==n.mark&&_e({warning:"Uuups someone else started editing this article."});break;case"updated":await e.reload(),(e=>{for(const[t]of Object.entries(e.changes())){const n=document.querySelector(`a.apply_changes[data-for=${e.getAttrRemoteName(t)}]`);n&&n.classList.remove("none")}})(e);break;case"destroyed":window.location.href="/user/articles?message=deleted"}};var nt=e=>{C.dispatch(b([e])),(0,a.subscribe)({to:e,with:tt(e)});const t=new i.UI.Form({for:e});t.render(),(e=>{for(const t of Array.from(document.querySelectorAll("a.apply_changes")))t.addEventListener("click",(t=>{t.preventDefault();const n=e.getObj(),r=n.getAttrName(t.target.getAttribute("data-for"));n[r]=n.changes()[r].is,e.fill(r),t.target.classList.add("none")}))})(t)};function rt(e){let{article:t,onArticleDestroyed:n}=e;return F.createElement("tr",{id:`article_${t.id}`},F.createElement("td",null,t.title),F.createElement("td",null,t.content),F.createElement("td",{className:"comments_quantity"},t.commentsCount),F.createElement("td",{className:"published"},t.publishedAt?"yes":"no"),F.createElement("td",null,F.createElement("a",{href:`/user/articles/${t.id}`},"Show")," |",F.createElement("a",{href:`/user/articles/${t.id}/edit`},"Edit")," |",F.createElement("a",{href:`/user/articles/${t.id}`,className:"delete_article",onClick:async e=>{if(e.preventDefault(),!confirm("Are you sure?"))return;const r=await t.delete(null);var a;r.success&&C.dispatch((a=r.id,{type:l,id:a})),n(r)}},"Delete")))}rt.propTypes={article:V().instanceOf($).isRequired,onArticleDestroyed:V().func.isRequired};var at=rt;function it(e){const[t,n]=(0,F.useState)(e.articles);(0,F.useEffect)((()=>{const e=C.subscribe((()=>n(C.getState().articles)));return()=>{e()}}),[]);const r=t.map((t=>F.createElement(at,{key:t.id,article:t,onArticleDestroyed:e.onArticleDestroyed})));return F.createElement(F.Fragment,null,r)}it.propTypes={articles:V().arrayOf(V().instanceOf($)).isRequired,onArticleDestroyed:V().func.isRequired};var st=it;const ot=e=>{e.success?_e({notice:e.notice}):_e({alert:e.alert})};class ct extends a.Controllers.Base{}ct.Articles=class{async index(){"deleted"===a.helpers.params.message&&_e({alert:"Article has been deleted."});const e=await $.get("all");C.dispatch(v(e.resources)),(0,U.render)(F.createElement(st,{articles:e.resources,onArticleDestroyed:ot}),document.getElementById("article_list"))}show(){(async()=>{const e=await $.find(a.helpers.params.id);C.dispatch(v([e])),(e=>{null!==e&&((0,a.subscribe)({to:e,with:Ze(e)}),(e=>{document.getElementById("publish_article").addEventListener("click",(async t=>{t.preventDefault(),t.target.textContent="Publishing...";try{await e.put("publish"),document.getElementById("publish_article").outerHTML="<span>Published!</span>"}catch(e){document.getElementById("publish_article").textContent="Publish",_e({alert:"Connection error!"})}}))})(e),(e=>{const t=document.getElementById("edit_link").getAttribute("href");document.getElementById("edit_link").setAttribute("href",t.replace("/0/",`/${e}/`))})(e.id),Ge(e))})(e)})(),(async()=>{const e=await D.all({articleId:a.helpers.params.id});C.dispatch(E(e.resources,a.helpers.params.id)),(0,U.render)(F.createElement(et,{articleId:a.helpers.params.id,comments:e.resources}),document.getElementById("comments"))})()}new(){nt(new $)}async edit(){(async e=>{const t=await D.all({articleId:e});C.dispatch(E(t.resources,e)),(0,U.render)(F.createElement(et,{articleId:e,comments:t.resources,isAdmin:!0}),document.getElementById("comments"))})(a.helpers.params.id);const e=await $.find(a.helpers.params.id);nt(e)}},ct.Rooms=Je;var lt=ct;const dt=(e,t)=>{let{article_id:n}=e;const[r,a]=O(C.getState(),n);if(!r)return;const i=new $({...r,commentsCount:r.commentsCount+t});C.dispatch(w(i,a))};$.Comment=D,Fe.Member=qe;const ut=(0,a.init)({cable:(0,s.zD)(),controllers:{Admin:de,Main:Te,User:lt},models:{Article:$,Room:Fe,User:L},notificationCenter:async e=>{switch(e.type){case"PING":pt.getEnv().namespaceController.constructor===lt&&alert("Ping!");break;case"NEW_MESSAGE":(pt.getEnv().namespaceController.constructor!==lt||pt.getEnv().controller.constructor!==Je||"show"!==pt.getEnv().action?()=>{}:pt.getEnv().controller.callbacks.receivedMessage)(e.message,e.author);break;case"Article created":(async e=>{let{id:t}=e;if(pt.getEnv().namespaceController.constructor!==lt)return;const n=await $.find({id:t,abbr:!0});C.dispatch(b([n]))})(e.payload);break;case"Article published":(async e=>{let{id:t}=e;if(pt.getEnv().namespaceController.constructor===de){const e=await $.find({id:t,abbr:!0,resource:"admin"});C.dispatch(function(e){return{type:c,articles:e}}([e]))}else{const e=await $.find({id:t,abbr:!0});C.dispatch(b([e]))}})(e.payload);break;case"Article updated":(async e=>{let{id:t}=e;const n={id:t,abbr:!0};pt.getEnv().namespaceController.constructor===de&&(n.resource="admin");let[r,a]=O(C.getState(),t);r&&(r=await $.find(n),C.dispatch(w(r,a)))})(e.payload);break;case"Article.Comment created":(async e=>{let{article_id:t,id:n}=e;const r={articleId:t,id:n};pt.getEnv().namespaceController.constructor===Te&&(r.resource="main");const[a]=O(C.getState(),t);if(!a)return;const i=await D.find(r);null!==i&&(C.dispatch(function(e,t){return{type:m,articleId:t,comments:e}}([i],t)),dt({article_id:t},1))})(e.payload);break;case"Article.Comment destroyed":dt(e.payload,-1),(e=>{let{article_id:t,id:n}=e;C.dispatch(function(e,t){return{type:p,id:e,articleId:t}}(n,t))})(e.payload);break;case"Article.Comment updated":(async e=>{let{article_id:t,id:n}=e;const[r,a]=R(C.getState(),n,{parentId:t});if(!r)return;const i=await r.reload();C.dispatch(_(i,t,a))})(e.payload);break;case"User created":{const t=await L.find(e.payload.id);C.dispatch(function(e){return{type:g,users:e}}([t]));break}}},notifications:{log:!0,size:10,disconnectedForTooLong:()=>{_e({alert:"You have been disconnected from the server for too long. Reload page!",hide:!1})}},postInit:()=>{"test"===document.querySelector("body").getAttribute("data-rails-env")&&ut.getWire().setPollingTime(1e3)}});(0,i.connect)((0,a.createConnector)(ut));var mt,pt=ut;a.Validators.Vulgarity=(function(e,t,n){(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(mt=class extends a.Validators.Base{constructor(){super()}validate(){if(null!=this.val)switch(typeof this.val){case"string":{const e=this._getVulgarWord();if(!new RegExp(`${e}`,["i"]).exec(this.val))return;this._addErrorMessage();break}default:throw new TypeError(`Vulgarity validator is applicable only for strings and ${this.attr} isn't.`)}}_addErrorMessage(){const e=a.I18n[(0,a.getLocale)()].errors.messages.vulgarity;this.obj.addErrorMessage(e,{for:this.attr})}_getVulgarWord(){switch((0,a.getLocale)()){case"pl":return"kurwa";case"en":return"fuck"}}},"identity","Vulgarity"),mt),a.I18n.pl={variants:{few(e){const t=parseInt((n=String(e))[n.length-1]);var n;-1!==[2,3,4].indexOf(t)&&(2!==String(e).length||String(e)[0])}},models:{},attributes:{},ui:{form:{sending:"Wysyłam...",success:"Sukces",errors:{connection:"Błąd z połączeniem",invalid_data:"Nieprawidłowe dane"}}},date:{formats:{default:"%d-%m-%Y",short:"%d %b",long:"%B %d, %Y"},day_names:["niedziela","poniedziałek","wtorek","środa","czwartek","piątek","sobota"],abbr_day_names:["nie","pon","wto","śro","czw","pią","sob"],month_names:["styczeń","luty","marzec","kwiecień","maj","czerwiec","lipiec","sierpień","wrzesień","październik","listopad","grudzień"],abbr_month_names:["sty","lut","mar","kwi","maj","cze","lip","sie","wrz","paź","lis","gru"]},errors:{messages:{accepted:"musi zostać zaakceptowane",blank:"nie może być puste",confirmation:"nie zgadza się z polem %{attribute}",empty:"nie może być puste",equal_to:"musi być równe %{count}",even:"musi być parzyste",exclusion:"jest zarezerwowane",greater_than:"musi być większe od %{count}",greater_than_or_equal_to:"musi być większe lub równe %{count}",inclusion:"nie znajduje się na liście dopuszczalnych wartości",invalid:"jest nieprawidłowe",less_than:"musi być mniejsze od %{count}",less_than_or_equal_to:"musi być mniejsze lub równe %{count}",not_a_number:"nie jest liczbą",not_an_integer:"musi być liczbą całkowitą",odd:"musi być nieparzyste",present:"musi być puste",too_long:{few:"jest za długie (maksymalnie %{count} znaki)",many:"jest za długie (maksymalnie %{count} znaków)",one:"jest za długie (maksymalnie jeden znak)",other:"jest za długie (maksymalnie %{count} znaków)"},too_short:{few:"jest za krótkie (przynajmniej %{count} znaki)",many:"jest za krótkie (przynajmniej %{count} znaków)",one:"jest za krótkie (przynajmniej jeden znak)",other:"jest za krótkie (przynajmniej %{count} znaków)"},wrong_length:{few:"ma nieprawidłową długość (powinna wynosić %{count} znaki)",many:"ma nieprawidłową długość (powinna wynosić %{count} znaków)",one:"ma nieprawidłową długość (powinna wynosić jeden znak)",other:"ma nieprawidłową długość (powinna wynosić %{count} znaków)"},other_than:"musi być inna niż %{count}"}}},a.I18n.pl.models.User="Użytkownik",a.I18n.pl.attributes.User={password:"Hasło",passwordConfirmation:"Powtórz hasło"},a.I18n.en.errors.messages.vulgarity="contains strong language.",a.I18n.pl.errors.messages.vulgarity="zawiera mocny język.",a.I18n.en.date={formats:{default:"%Y-%m-%d",short:"%b %d",long:"%B %d, %Y"},day_names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr_day_names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_names:["January","February","March","April","May","June","July","August","September","October","November","December"],abbr_month_names:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},window.test={getLine:()=>pt.getLine(),getWire:()=>pt.getWire()}}},n={};function r(e){var a=n[e];if(void 0!==a)return a.exports;var i=n[e]={exports:{}};return t[e].call(i.exports,i,i.exports,r),i.exports}r.m=t,e=[],r.O=function(t,n,a,i){if(!n){var s=1/0;for(d=0;d<e.length;d++){n=e[d][0],a=e[d][1],i=e[d][2];for(var o=!0,c=0;c<n.length;c++)(!1&i||s>=i)&&Object.keys(r.O).every((function(e){return r.O[e](n[c])}))?n.splice(c--,1):(o=!1,i<s&&(s=i));if(o){e.splice(d--,1);var l=a();void 0!==l&&(t=l)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[n,a,i]},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={34:0};r.O.j=function(t){return 0===e[t]};var t=function(t,n){var a,i,s=n[0],o=n[1],c=n[2],l=0;if(s.some((function(t){return 0!==e[t]}))){for(a in o)r.o(o,a)&&(r.m[a]=o[a]);if(c)var d=c(r)}for(t&&t(n);l<s.length;l++)i=s[l],r.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return r.O(d)},n=self.webpackChunk=self.webpackChunk||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var a=r.O(void 0,[736],(function(){return r(43312)}));a=r.O(a)}();
//# sourceMappingURL=application.js.map